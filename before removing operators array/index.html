<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Calculator</title>
    <meta charset="UTF-8">
    <style>
        body {
            background-color:black;
            color: white;
        }

        #calculator {
            width: 500px;
            /*  doing a lot of work here, need to make this width the width of the bottom half of the calculator*/


            padding: 50px;
        }

        #calc-display {
            background-color: white;
            color: black;
            font-size: 3em;
            font-family:sans-serif;
            height: 55px;
            margin-bottom: 10px;
            padding: 10px;
        }

        #below-display {
            display: flex;
        }

        #calc-numpad {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            gap: 10px;
        }

        #calc-numpad button{
            font-size: 3em;
            font-family:sans-serif;
        }

        #calc-operators {
            display: grid;
            grid-template-columns: 100px;
            gap: 10px;
            padding-left: 10px;
        }

        #calc-operators button{
            font-size: 3em;
        }


    

    </style>
  </head>

  <body>

    <div id="calculator">
        <div id="calc-display"></div>

        <div id="below-display">

            <div id="calc-numpad">
                <button id="7">7</button>
                <button id="8">8</button>
                <button id="9">9</button>

                <button id="4">4</button>
                <button id="5">5</button>
                <button id="6">6</button>

                <button id="1">1</button>
                <button id="2">2</button>
                <button id="3">3</button>

                <button id=".">.</button>
                <button id="0">0</button>
                <button id="=">=</button>
                
            </div>
        

            <div id="calc-operators">
                <button id="AC">AC</button>
                <button id="+">+</button>
                <button id="-">-</button>
                <button id="*">*</button>
                <button id="/">/</button>
            </div>
        
        </div>
    </div>


        


        
    </button>

    <script>

    
    let operands = [];
    let operators = [];

    let firstOperand;
    let secondOperand;
    let currentOperator;

    let waitingForOperand = true;
    let waitingForSecondOperand = false; // for clearing the display after first operand and operator are entered
    let isFirstEqualsOperation = true;
    let waitingOperation = false; // if 

    initalizeCalculatorButtons();

    function allClear() {
        updateDisplay(); // clear display
        
        operands = [];
        operators = [];

        firstOperand = undefined;
        secondOperand = undefined;
        currentOperator = undefined;

        waitingForOperand = true;
        waitingForSecondOperand = false;
        isFirstEqualsOperation = true;

        console.log(`${operands} ${operators} ${firstOperand} ${secondOperand} ${currentOperator} WFO:${waitingForOperand} WFSO:${waitingForSecondOperand} FEO:${isFirstEqualsOperation}`);
    }    

    function add (x, y) {
        return x + y;
    }

    function subtract (x,y) {
        return x - y;
    }

    function multiply (x, y) {
        return x * y;
    }

    function divide (x, y) {
        return x / y;
    }

    function operate (x, operator, y) {
        
        // convert to number if input is a string
        const int_x = new Number(x);
        const int_y = new Number(y);
        // no need to convert operator, it will always be a string
        
        console.log(`${x} ${operator} ${y}`);

        switch(operator){
            case '+': 
                return add(int_x,int_y);
            case '-':
                return subtract(int_x, int_y);
            case '*':
                return multiply(int_x,int_y);
            case '/':
                return divide(int_x,int_y);
            default:
                console.log("Invalid operator: " + operator);
        }

    }

    function updateDisplay (displayValue) {
        const calculatorDisplay = document.querySelector("#calc-display");
        calculatorDisplay.textContent = displayValue;
    }

    function getDisplayValue () {
        const calculatorDisplay = document.querySelector("#calc-display");
        return calculatorDisplay.textContent;
    }

    // create event listeners on each button
    function initalizeCalculatorButtons() {
        const numpadButtons = document.querySelectorAll("#calc-numpad button");
        //console.log(numpadButtons);
        
        for (let button of numpadButtons) {
            
            if (button.id == "=") {
                button.addEventListener("click", ()=> {
                    equalsOperator();
                })
            } else {
                button.addEventListener("click", ()=> {
                    enterDigit(button.id);
                })
            }
        }

        const operatorButtons = document.querySelectorAll("#calc-operators button");
        //console.log(operatorButtons);
        
        for (let button of operatorButtons) {
            if (button.id == "AC") {
                button.addEventListener("click", ()=> {
                allClear();
                })
            } else {
                button.addEventListener("click", ()=> {
                enterOperator(button.id);
                })
            }
        }
    }


    // if waitingForOperand is true, push() digit into the operands array then switch waitingForOperand to false
    // is waitingForOperand is false, a new digit entered triggers the removal of the last entry, then updated with the new value
    function enterDigit (digit) {
        
        // entering a digit resets isFirstEqualsOperation to true
        setFirstEqualsOperation(true);

        if(waitingForOperand) {
            updateDisplay();
        }
        
        // if the second operand needs to be inputted, clear the display in preparation
        // if second operand is being inputted, that means the final operator has been chosen
        if (waitingForSecondOperand) {
            operators.push(currentOperator);
            console.log(operators);
            updateDisplay();
            waitingForSecondOperand = false;
        }

        let oldDisplayValue = new Number(getDisplayValue());
        const int_digit = new Number(digit);
        let newDisplayValue = new Number((oldDisplayValue * 10) + int_digit);

        updateDisplay(newDisplayValue);

        if (waitingForOperand) {
            operands.push(newDisplayValue);
            setWaitingforOperand(false);
        } else {
            operands.pop();
            operands.push(newDisplayValue);
        }

        // console.log(operands);
        //console.log(operators);

        // console.log(`(old value: ${oldDisplayValue} * 10) + ${int_digit} = new value: ${newDisplayValue}`);
    }

    // for some reason I can only edit this global variable via function and not with a simple waitingForOperand = false in a function???? The variable is global and should be able to be accessed everywhere
    // need to look up this. Scope of waitingForOperand should be global but its not. 
    function setWaitingforOperand(boolean) {
        waitingForOperand = boolean;
        //console.log("waitingForOperand: " + waitingForOperand);
    }

    // currentOperator is stored in operators in the enterDigit() function because the calculator needs to wait until the user selects the final operator (calc allows picking multiple operators, but only the last chosen operator is used)
    function enterOperator (operator) {

        // an existing operator in the array indicates that there is a previous operation that needs to be completed before the current one is done
        if(operators.length > 0) {
            equalsOperator();
        }

        currentOperator = operator;

        setWaitingforOperand(true);
        waitingForSecondOperand = true;

        //console.log(`currentOperator:${currentOperator} waitingForSecondOperand:${waitingForSecondOperand}`);
    }

    function enterDecimal() {

    }

    function equalsOperator () {

        // normally first operand comes first in the array, then the second operand
        if(isFirstEqualsOperation) {
            firstOperand = operands[operands.length-2]; 
            secondOperand = operands[operands.length-1];
            currentOperator = operators.pop();
            console.log(operators);
            setFirstEqualsOperation(false);
        } 
        else { // if the equals button gets pressed multiple times, save the second operand and current operator (by not updating them) and only update the first operand as the last pushed value (the result of the last operation)
            firstOperand = operands[operands.length-1]; 
        }

        // console.log(`${firstOperand} ${currentOperator} ${secondOperand}`);

        // divide by zero resets the calculator and exits
        if(currentOperator == "/" && secondOperand == 0) {
            alert("Error: Divide by zero. Calculator reset");
            allClear();
            return;
        }
        // if any one of these variables in undefined, it means a complete math operation hasn't been entered. Exit the method silently to wait for additonal user input
        else if (firstOperand == undefined || secondOperand == undefined || currentOperator == undefined) {
            return;
        }
        else {
            let newDisplayValue = operate (firstOperand, currentOperator, secondOperand);

            updateDisplay(newDisplayValue);
            operands.push(newDisplayValue);
            setWaitingforOperand(true); // calculation complete, set calculator to wait for new operand
        }
        // console.log(operands);
        // console.log(operators);
    }

    function setFirstEqualsOperation(boolean) {
        isFirstEqualsOperation = boolean;
    }



    </script>
  </body>
</html>